---
layout: post
title: "使用rpmbuild构造离线RPM包"
date: 2013-05-05 16:55
comments: true
categories: Linux RPM
---

###构造RPM包步骤

1.配置打包环境  
2.获取源代码  
3.编写SPEC文件  
4.使用rpmbuild打包  
<!-more->
####1.配置打包环境

（1）构造rpm包首先需要安装rpmbuild,gcc工具。

（2）在Fedora等系统中，并不会直接生成构造rpm所需的目录。因此，需要手动创建。以Fedora为例，执行：  
`sudo -i  
mkdir -P /rpmbuild/{S{OURCE,PEC,RPM}S,BUILD,RPMS}`

####2.获取源代码
（1）要制作rpm包需要先将源码压缩为tar.gz格式，假设源文件存放的目录为test-1，则执行以下命令：  
`tar -cf test-1.tar test-1  
gzip -9 test-1.tar`

结果如下图所示：  
![unzip](http://farm9.staticflickr.com/8134/8709576269_8f5a15120e.jpg)  
（2）将源文件压缩包放入rpmbuild/SOURCES/ 目录中。
####3.编写SPEC文件
spec文件是构造rpm包的核心，包含所有rpm包的关键信息，因此编写spec文件是最为重要的环节。  
测试过程中使用的spec文件较为简单，算是一个基本的spec文件模版,如下：  ![SPEC](http://farm9.staticflickr.com/8407/8709578559_743089ed1b.jpg)  
将编写好的spec文件放入 rpmbuild/SPECS/ 目录中。  
####4.使用rpmbuild打包  
假设我们编写的spec文件名为test.spec,执行以下命令进行制作二进制包：  
`rpmbuild -bb test.spec`  
如果之前的步骤正确无误，则会自动进行打包，如下图：  
![build-step1](http://farm9.staticflickr.com/8415/8710720266_21d98489dc.jpg)  
![build-step2](http://farm9.staticflickr.com/8256/8710711360_610dc4230a.jpg")  
如图所示，我们制作出了自己的rpm包，rpm包生成在 rpmbuild/RPMS/i386 目录下(i386是系统的架构类型)。
![rpm](http://farm9.staticflickr.com/8257/8709577941_7c9ab42a3f.jpg)  
使用yum工具安装并检测制作的rpm包  
首先使用yum工具安装一下我们制作的rpm包，检测是否能够成功安装。  
`yum install test-1-1.i386.rpm`  
执行过程如下图所示：  
![install-step1](http://farm9.staticflickr.com/8408/8709614221_372bd07a29.jpg)  
输入y,继续  
![install-step2](http://farm9.staticflickr.com/8552/8710705248_59b3e6f7cb.jpg)  
安装成功，确认一下是否在已安装列表中，可以使用下列命令：  
`yum list "test-1-1.i386`  
结果如下图：  
![check](http://farm9.staticflickr.com/8138/8710703614_beec910308.jpg)  
可以看到，我们的rpm包已经成功的安装在系统中了。

###整个构造RPM包的流程到此结束，我们可以使用自己构造的RPM包在相同的系统中使用了。
  
